{% extends 'activities/show.html' %}{% load l10n %}
{% block review_content %}
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingOne">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">تقييم المركز الإعلامي</a>
                    </h4>
                </div>
                <div id="collapseOne" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingOne">
                    <div class="panel-body">
                        {% if activity.get_media_assessment %}
                            <table class="table">
                                <thead>
                                    <th>المعيار</th>
                                    <td>النقاط</td>
                                </thead>
                                <tbody>
                                    {% for criterionvalue in activity.get_media_assessment.criterionvalue_set.all %}
                                    <tr>
                                        <td>{{ criterionvalue.criterion.ar_name }}</td>
                                        <td>{{ criterionvalue.value }}</td>
                                    </tr>
                                    {% endfor %}
                                    <tr>
                                        <th>الإجمالي</th>
                                        <th>{{ activity.get_media_assessment_points }}</th>
                                    </tr>
                                </tbody>
                            </table>
                        {% else %}
                        <p>لم يُقيّم المركز الإعلامي هذا النشاط بعد.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

<div class="panel panel-default panel-shadow" data-collapsed="0">
	<!-- panel body -->
	<div class="panel-body with-table">
		<table class="table table-bordered table-responsive">
		<form method="post">
            {{ form.errors }}
		{% csrf_token %}
		<colgroup>
			<col class="col-md-2">
			<col class="col-md-7">
			<col class="col-md-3">
		</colgroup>
		<thead>
			<tr>
				<th>المعيار</th>
				<th>الخيارات</th>
				<th>النقاط</th>
			</tr>
		</thead>

		<tbody>
			<tr>
				<th>فكرة النشاط</th>
				<td>
					<p class="alert alert-warning"><i class="entypo-eye"></i>
					تصنيف النشاط: {{ activity.category }}
					</p>
					<label>
						<input type="radio" value="3" name="idea_option"> فكرة تتفرع إلى نقاط<span class="points">(3 نقاط)</span>
					</label>

					<br>
					<label>
						<input data-other='true' type="radio" value="" name="idea_option"> أخرى
					</label>
				</td>
				<td>{{ form.criterion_idea }}</td>
			</tr>
            <tr>
                <th>فكرة غير تقليدية</th>
                <td>
                    <label>
                        <input type="radio" value="10" name="new_idea_option"> نعم <span class="points">(10 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="new_idea_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>

              <td>{{ form.criterion_new_idea }}</td>

            </tr>

            <tr>
      				<th>فكرة طالب/ة</th>
      				<td>
      					<div class="alert alert-warning"><i class="entypo-eye"></i>
                              إذا كانت فكرة طالب/ة، يذكر ذلك في الوصف.  وصف هذا النشاط: <blockquote>{{ activity.description }}</blockquote>
                          </div>

      					<label>
      						<input type="radio" value="3" name="student_idea_option"> نعم <span class="points">(3 نقاط)</span>
      					</label>
      					<br>
      					<label>
      						<input type="radio" value="0" name="student_idea_option"> لا <span class="points">(لا نقاط)</span>
      					</label>
      					<br>
      					<label>
      						<input data-other='true' type="radio" value="" name="student_idea_option"> أخرى
      					</label>
      				</td>
      				<td>{{ form.criterion_Student_idea }}</td>
      			</tr>

            <tr>
      				<th>مكان النشاط</th>
      				<td>
      					<label>
      						<input type="checkbox" value="5" name="place_option"> نشاط داخل كليات الجامعة<span class="points">(5 نقاط)</span>
      					</label>
                <br>
                <label>
      						<input type="checkbox" value="10" name="place_option"> نشاط خارج كليات الجامعة<span class="points">(10 نقاط)</span>
      					</label>
                <br>
                <label>
                  <input type="checkbox" value="3" name="place_option"> نشاط إلكتروني <span class="points">(3 نقاط)</span>
                </label>
      					<br>
      				</td>
      				<td>{{ form.criterion_place }}</td>
      			</tr>

            <tr>
                <th>طرح الفكرة بطريقة غير تقليدية</th>
                <td>
                   <label>
                        <input type="radio" value="10" name="creative_idea_option"> نعم <span class="points">(10 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="creative_idea_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>
                <td>{{ form.criterion_creative_idea }}</td>
            </tr>

            <tr>
                <th>استعمال وسائل مصاحبة </th>
                <td>
                    <label>
                        <input type="radio" value="2" name="use_resources_option"> نعم <span class="points">(2 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="use_resources_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>
                <td>{{ form.criterion_use_resources }}</td>
            </tr>

            <tr>
                <th>الشكل العام لمكان النشاط</th>
                <td>
                    <label>
                        <input type="radio" value="2" name="apperance_option"> نعم <span class="points">(2 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="apperance_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>
                <td>{{ form.criterion_apperance }}</td>
            </tr>

            <tr>
                <th> إرشاد وتنظيم الحضور</th>
                <td>
                    <label>
                        <input type="radio" value="2" name="attendes_orgnisation_option"> نعم <span class="points">(2 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="attendes_orgnisation_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>
                <td>{{ form.criterion_attendes_orgnisation }}</td>
            </tr>
            <tr>
                <th> رضا الحضور</th>
                <td>
                    <label>
                        <input type="radio" value="2" name="attendes_satisfaction_option"> نعم <span class="points">(2 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="attendes_satisfaction_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>
                <td>{{ form.criterion_attendees_satisfaction }}</td>
            </tr>

            <tr>
                <th> حسن إدارة النشاط</th>
                <td>
                    <label>
                        <input type="radio" value="2" name="orgnisation_option"> نعم <span class="points">(2 نقاط)</span>
                    </label>
                    <br>
                    <label>
                        <input type="radio" value="0" name="orgnisation_option"> لا <span class="points">(لا نقاط)</span>
                    </label>
                </td>
                <td>{{ form.criterion_orgnisation }}</td>
            </tr>

            <tr>
      				<th>التعاون</th>
      				<td>
      					<label>
      						<input type="checkbox" value="15" name="cooperation_option"> التعاون مع رئاسة نادي الطلاب <span class="points">(15 نقاط)</span>
      					</label>
                <br>
                <label>
      						<input type="checkbox" value="10" name="cooperation_option"> الشراكة مع جهة خارجية<span class="points">(10 نقاط)</span>
      					</label>
                <br>
                <label>
                  <input type="checkbox" value="10" name="cooperation_option"> رعاية من جهة خارجية<span class="points">(10 نقاط)</span>
                </label>
              		</td>
      				<td>{{ form.criterion_cooperation }}</td>
      			</tr>


			<tr>
				<th>أيام النشاط </th>
				<td>
					<div class="alert alert-warning">
            <p><i class="entypo-eye"></i>
            {% if activity.get_days > 1 %}
            كان لهذا النشاط  {{ activity.get_days }} أيام
            {% else %}
            لم يكن لهذا النشاط سوى يوم واحد.
            {% endif %}
            <br>
            كان لهذا النشاط {{ activity.episode_set.count }} أجزاء وهي في الأيام التالية:
          </p>
              <ul>
                  {% for episode in activity.episode_set.all %}
                  <li>
                    {{ episode }} من {{ episode.start_date }} إلى {{ episode.end_date }}
                  </li>
                  {% endfor %}
              </ul>


          </div>
					{% if activity.get_days > 1 %}
					<label>
						<input type="radio" value="3" data-choice="episodes" name="activity_days_option"> أحسب لكل يوم 3 نقاط
					</label>
              <br>
					{% endif %}
					<br>
					<label>
						<input data-other='true' type="radio" value="" name="activity_days_option"> أخرى
					</label>
				</td>
				<td>{{ form.criterion_activity_days }}</td>
			</tr>



      <br>
      <label>			<tr>
    <th>ساعات النشاط</th>
    <td>
      <p class="alert alert-warning"><i class="entypo-eye"></i>
      {% if activity.get_hours > 1 %}
    كان لهذا النشاط  {{ activity.get_hours }}   ساعة
      {% else %}
      لم يكن لهذا النشاط سوى ساعة واحدة
      {% endif %}
                </p>

                {% if activity.episode_set.count > 1 %}
      					<label>
      						<input type="radio" value="1" data-choice="episodes" name="activity_hours"> نقطة لكل ساعة
  			</label>
            <br>
      				{% endif %}
      <br>
      <label>
        <input data-other='true' type="radio" value="" name="activity_hours"> أخرى
      </label>
    </td>
    <td>{{ form.criterion_activity_hours }}</td>
  </tr>


        <tr>
  				<th>برنامج نقاطي</th>
  				<td>
  					<p class="alert alert-warning"><i class="entypo-eye"></i>
              تحسب نقاط برنامج نقاطي بشكل ألي
              <br>
              وستضاف بشكل تلقائي لمجموع نقاط النادي في نهاية العام
              <br>
              حصل هذا النشاط على  {{ activity.get_codes }}  نقطة من برنامج نقاطي
              <br>
              حصل هذا النشاط على  {{ activity.get_points }}  نقطة من آلية التقيم

			<tr>
				<th>التعاون</th>
				<td>
					<div class="alert alert-warning"><i class="entypo-eye"></i>
					{% if activity.secondary_clubs.exists %}
					الأندية المتعاونة مع {{ activity.primary_club }} لإقامة هذا النشاط هي:
                        <ul>
                            {% for secondary_club in activity.secondary_clubs.all %}<li>{{ secondary_club }}</li>{% endfor %}
                        </ul>
					{% else %}
					لم يُسجّل أي نادٍ متعاون لإقامة هذا النشاط.
					{% endif %}
					</div>
                    {% if activity.secondary_clubs.exists %}
					<label>
						<input type="radio" data-choice="equal-points" name="cooperation_option"> تقسيم العمل كان بالمناصفة <span class="points">(نفس نقاط النشاط تعطى لكلِ من الأندية المتعاونة)</span>
					</label>
					<br>
					<label>
						<input type="radio" value="3" name="cooperation_option"> تقسيم العمل لم يكن مناصفة <span class="points">(3 نقاط لكلٍ من الأندية المتعاونة)</span>
					</label>
					<br>
					<label>
						<input type="radio" data-choice="none" value="0" name="cooperation_option"> لا تحسب التعاون <span class="points">(لا نقاط للأندية المتعاونة)</span>
					</label>
                    <br>
					<label>
						<input type="radio" data-choice="other" value="" name="cooperation_option"> أخرى
					</label>
                    {% endif %}
				</td>
				<td>{{ form.cooperator_points }}</td>
			</tr>
			<tr>
				<th  colspan="2">الإجمالي</th>
				<th class="total"></th>

			</tr>
			<tr>
				<td>
				ملاحظة
				</td>
				<td colspan="2">
				{{ form.notes }}
				</td>
			</tr>
			<tr><td colspan="3">
		    	<button type="submit" class="btn btn-primary btn-block">
		    		<span class="glyphicon glyphicon-ok-sign"></span> أرسل
		    	</button>
			</td></tr>
		</tbody>
	</form>
	</table>

	</div>
</div>
<script>
$(function(){
	// All criteria fields should be required.
	$('input[type=number]').prop('required', 'required');

	// Choosing a radio input changes the criterion field.
	$('input[type=radio]').change(function(){
		criterion_field_name = 'criterion_' + $(this).prop('name').replace('_option', '');
		criterion_field = $('#id_' + criterion_field_name);
		$(criterion_field).val($(this).val());
	});
	// Choosing the criterion field results in choosing the match radio option (or other if no matches were found).
    function link_text_to_radio(){
		criterion_code_name = $(this).prop('name').replace('criterion_', '');
		entered_value = $(this).val()
		entered_option = $('input[name=' + criterion_code_name +'_option][value=' + entered_value + ']:first');
		if (entered_option.length){
			entered_option.prop('checked', 'checked');
		}else{
			other_option = $('input[name=' + criterion_code_name +'_option][data-other=true]');
			other_option.prop('checked', 'checked');
		}
	}
    $.each($('input[name^=criterion_]'), link_text_to_radio);
	$('input[name^=criterion_]').on('change', link_text_to_radio);
	// Episode auto calculation (if the episode input is there anyway)
	var episode_input = $('input[data-choice=episodes][name=episodes_option]');
	var episode_count = {{ activity.episode_set.count }};
	var eispide_points = episode_count * 3;
	episode_input.val(eispide_points);
	episode_input.append('<span class="points">(' + eispide_points + ' نقاط)</span>');
    // If students' percentage is 80 or more, automatically select give them the credit.
    var evaluation_percentage = {% if activity.get_evaluation_percentage %}{{ activity.get_evaluation_percentage|unlocalize }}{% else %}0{% endif %};
    if (80 >= evaluation_percentage){
        $('input[data-choice=episodes][name=student_evaluation_option]').prop('checked', 'checked').trigger('change');
    }
    // Time of submission
    if ({{ submission_interval }} >= 14 ){
        $('input[data-choice=before_time][name=early_sumbission_option]').prop('checked', 'checked').trigger('change');
    }
    // Cooperation
    {% if activity.secondary_clubs.exists %}
	var episode_input = $('input[name=cooperation_option]').change(function(){
        if ($('input[data-choice=equal-points][name=cooperation_option]').prop('checked')){
            $('#id_cooperator_points').addClass('equal-points');
        }else{
            $('#id_cooperator_points').removeClass('equal-points');
            $("#id_cooperator_points").val($(this).val());
        }
    });
    {% else %}
    $("#id_cooperator_points").hide();
    {% endif %}
    // On loading the page and on changing and click fields, update the total count. .
    function updateTotal(){
        var total = 0;
		$.each($('input[type=number][name^=criterion_]'), function(index, element){
			total += +$(element).val();
		});
		$('.total').html(total);
        // If the total changes, also update the points given for cooperator, but only if equal points are given.
        $("#id_cooperator_points.equal-points").val(total);
    }
    updateTotal();
    $('input[type=number], input[type=radio]').on('click change', updateTotal);

	$("textarea").removeAttr("cols")
		.removeAttr("rows")
		.css("height", "100%")
		.css("width", "100%")
		.addClass("form-control")
		.addClass("autogrow");
});
</script>
<style>
.points{
	color: black;
}
.alert{
    margin-bottom: 5px;
}
blockquote{
    margin-bottom: -8.5px;
}
</style>
{% endblock %}
