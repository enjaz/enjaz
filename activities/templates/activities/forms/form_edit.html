{% extends 'activities_base.html' %}{% load i18n %}
{% block title %}{% if builder_form.instance.pk %}{% trans "Edit Form" %}{% else %}{% trans "Add Form" %}{% endif %}{% endblock %}
{% block content %}
    <style>
        .errorlist {color:#f00;}
    </style>

    {% if builder_form.instance.pk %}
    <h1>{% trans "Edit Form" %}</h1>
    <a class="btn btn-xs btn-default btn-icon" href="{% url 'forms:form_detail' object_id builder_form.instance.get_url_attr %}">
        <i class="entypo-eye"></i>
        {% trans "View on site" %}
    </a>
    <a class="btn btn-xs btn-default btn-icon" href="{% url 'forms:form_entries' object_id builder_form.instance.pk %}">
        <i class="entypo-list"></i>
        {% trans "View entries" %}
    </a>

    <a class="btn btn-xs btn-danger btn-icon" href="{% url 'forms:delete_form' object_id builder_form.instance.pk %}">
        <i class="entypo-trash"></i>
        {% trans "Delete form" %}
    </a>
    {% else %}
    <h1>{% trans "Add Form" %}</h1>
    {% endif %}
    <hr>
    <form method="post">
        {% csrf_token %}
        {% load bootstrap3 %}
        {% bootstrap_form builder_form %}

        {# Following snippet (slightly modified) from https://djangosnippets.org/snippets/1442/ #}
        {{ formset.management_form }}
        {{ formset.non_form_errors.as_ul }}
        <table id="formset" class="form">
        {% for form in formset.forms %}
          {% if forloop.first %}
          <thead><tr>
            {% for field in form.visible_fields %}
            <th>{{ field.label|capfirst }}</th>
            {% endfor %}
          </tr></thead>
          {% endif %}
          <tr class="form-container">
          {% for field in form.visible_fields %}
            <td>
            {# Include the hidden fields in the form #}
            {% if forloop.first %}
              {% for hidden in form.hidden_fields %}
              {{ hidden }}
              {% endfor %}
            {% endif %}
                <div class="form-group">
              {{ field.errors.as_ul }}
              {{ field }}
                </div>
            </td>
          {% endfor %}
          </tr>
        {% endfor %}
        </table>
        <hr>
        <button class="btn btn-primary btn-block" type="submit">
            <i class="entypo-check"></i>
            {% trans "Submit" %}
        </button>
    </form>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.formset/1.2/jquery.formset.min.js"></script>
<script type="text/javascript">
    // Style the formset fields properly
    $(".form-container .form-group").find("input").addClass("form-control");
    $(".form-container").formset({
        prefix: '{{ formset.prefix }}',
        added: function (row) {
            // Set default values for `required` and `visible` fields
            row.find("[type=checkbox]").prop("checked", true);
        },
        addText: 'أضف حقلاً',
        deleteText: 'احذف',
        addCssClass: 'add-row btn btn-xs btn-primary',
    });
</script>
{% endblock %}