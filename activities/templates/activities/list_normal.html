{% extends 'activities_base.html' %}{% load staticfiles %}
{% block title %}الأنشطة{% endblock %}

{% block content %}


<div class="row">

<table id="activities" class="table table-bordered datatable">
    <thead>
        <th>#</th>
        <th>الاسم</th>
        <th>النادي المنظم</th>
        <th>تاريخ الإرسال</th>
        <th>تاريخ الانعقاد</th>
        <th>الحالة</th>
    </thead>
    <tbody>
    {% for activity in page_activities %}
    <tr>
        <td>{{ activity.id }}</td>
        <td><a href="{% url 'activities:show' activity.id %}">{{ activity.name }}</a></td>
        <td><a href="{% url 'clubs:show' activity.primary_club.id %}">{{ activity.primary_club.name }}</a></td>
        <td>{{ activity.submission_date|date:"j F" }}</td>
        <td>{{ activity.get_first_date|date:"j F" }}</td>
        <td>
        {% if not activity.review_set.all %}
            {% if perms.activities.add_deanship_review or perms.activities.add_presidency_review  %}
                <a href="{% url 'activities:review' activity.id %}">مُعلّق</a>
            {% else %}
            معلّق
            {% endif %}
        {% elif activity.review_set.all|length_is:"1" %}
            {% if activity.review_set.all.0.review_type == 'P' %}
                {% if activity.review_set.all.0.is_approved == None %}
                ينتظر تعديلا
                {% elif activity.review_set.all.0.is_approved == True %}
                ينتظر مراجعة العمادة
                {% elif activity.review_set.all.0.is_approved == False %}
                رفضته الرئاسة
                {% endif %}
            {% elif activity.review_set.all.0.review_type == 'D' %}
                {% if activity.review_set.all.0.is_approved == True %}
                اعتمدته العمادة
                {% endif %}
            {% endif %}
        {% elif activity.review_set.all|length_is:"2" %}
            {% if activity.review_set.all.1.review_type == 'D' %}
                {% if activity.review_set.all.1.is_approved == None %}
                ينتظر تعديلا
                {% elif activity.review_set.all.1.is_approved == True %}
                اعتمده العمادة
                {% elif activity.review_set.all.1.is_approved == False %}
                رفضته الرئاسة
                {% endif %}
            {% endif %}
        {% endif %}
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>


<style>
	.calendar-env .calendar-body {
		width: 100%;
	}
</style>

<div class="row">
	<div class="col-md-12">
		<div class="calendar-env" dir="ltr"> <!-- It's problematic in rtl -->
			<!-- Calendar Body -->
			<div class="calendar-body">
				<div id="calendar"></div>
			</div>
				
		</div>
	</div>
</div>



</div>

{% endblock %}
{% block customscript %}
	<script src="{% static 'neon/assets/js/fullcalendar/fullcalendar.min.js' %}"></script>
    <script src="{% static 'neon/assets/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'neon/assets/js/dataTables.bootstrap.js' %}"></script>
	<script>
    var activities = [
		{% for activity in page_activities %}
			{% for episode in activity.episode_set.all %}
				{
					title : '{{ activity.name }}',
					start : '{{ episode.start_datetime.isoformat }}',
					end   : '{{ episode.end_datetime.isoformat }}',
					{% if not episode.is_single_day %}
					allDay: true,
					{% else %}
					allDay: false,
					{% endif %}
					url   : '{{ activity.id }}/'
				}{% if page_activities|length > forloop.counter %},{% endif %}
			{% endfor %}
		{% endfor %}
	];
	var calendar = $('#calendar');
    calendar.fullCalendar({
        header: {
            left: 'title',
            right: 'month,agendaWeek,agendaDay today prev,next'
        },

        //defaultView: 'basicWeek',

        editable: false,
        firstDay: 7,
        height: 600,
        droppable: false,
        allDayDefault: false,
        events: activities
    });

    var table = $('#activities');
    table.DataTable();
	</script>
{% endblock %}

