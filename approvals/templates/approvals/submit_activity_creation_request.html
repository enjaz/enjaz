{% extends "base_approvals.html" %}{% load bootstrap3 %}{% load staticfiles %}{% load i18n %}
{% block title %}ارفع طلب نشاط{% endblock %}

{% block styles %}
  {{ block.super }}

  <link rel="stylesheet" href="{% static 'css/animate.min.css' %}">

  <style>
    div.datepicker {
      right: auto;
    }
    div.bootstrap-timepicker-widget {
      direction: ltr;
    }

    /* Hide the "delete" checkbox that's automatically generated by django's formsets */
    .form-container td:last-child .form-group {
      display: none;
    }

    /* Float the panel title to the right so that panel options are displayed properly */
    .panel-group .panel>.panel-heading>.panel-title {
      float: right;
    }

    .form-group .control-label:after {
      /* FIXME: Show only for required fields */
      content:"*";
      vertical-align: super;
      color:red;
    }
  </style>
{% endblock %}

{% block content %}
  <h2>طلب نشاط جديد</h2>
  <form action="" method="post" class="form" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="panel panel-warning">
      <div class="panel-heading">
        <h4 class="panel-title">{% trans "مؤقت" %}</h4>
      </div>
      <div class="panel-body">
        {% bootstrap_field activity_request_form.submitter_team %}
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">{% trans "البيانات الأساسية" %}</h4>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-6">
            {% bootstrap_field activity_request_form.name %}
          </div>
          <div class="col-md-6">
            {% bootstrap_field activity_request_form.category %}
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            {% bootstrap_field activity_request_form.description %}
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">{% trans "البيانات الأساسية ٢" %}</h4>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-12">
            {% bootstrap_field activity_request_form.goals %}
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            {% bootstrap_field activity_request_form.organizer_count %}
          </div>
          <div class="col-md-6">
            {% bootstrap_field activity_request_form.participant_count %}
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">{% trans "التعاون" %}</h4>
      </div>
      <div class="panel-body">
        {% bootstrap_field activity_request_form.collaborating_teams %}
        {% bootstrap_field activity_request_form.inside_collaborators %}
        {% bootstrap_field activity_request_form.outside_collaborators %}
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">{% trans "الفئة المستهدفة" %}</h4>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-4">
            {% bootstrap_field activity_request_form.campus %}
          </div>
          <div class="col-md-4">
            {% bootstrap_field activity_request_form.specialty %}
          </div>
          <div class="col-md-4">
            {% bootstrap_field activity_request_form.gender %}
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">{% trans "التاريخ" %}</h4>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-4">
            {% bootstrap_field activity_request_form.start_date %}
          </div>
          <div class="col-md-4">
            {% bootstrap_field activity_request_form.end_date %}
          </div>
          <div class="col-md-4">
            {% bootstrap_field activity_request_form.location %}
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-warning panel-shadow">
      <div class="panel-heading">
        <h4 class="panel-title">الفعاليات</h4>
      </div>
      <div class="panel-body">
        {% with formset=event_request_formset %}
          {% include "approvals/components/event_request_formset.html" %}
        {% endwith %}
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">متطلّبات مخازن العمادة</h4>
      </div>
      <div class="panel-body">
        {% with formset=depository_item_request_formset %}
          {% include "approvals/components/formset.html" %}
        {% endwith %}
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">المتطلّبات</h4>
      </div>
      <div class="panel-body">
        {% with formset=requirement_request_formset %}
          {% include "approvals/components/formset.html" %}
        {% endwith %}
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">الملفات المرفقة</h4>
      </div>
      <div class="panel-body">
        {% with formset=file_attachment_formset %}
          {% include "approvals/components/formset.html" %}
        {% endwith %}
      </div>
    </div>

    {% buttons %}
      <button type="submit" class="btn btn-primary btn-block">
        {% bootstrap_icon "ok-sign" %} أرسل
      </button>
    {% endbuttons %}
  </form>
{% endblock %}
x
{% block scripts %}

  {{ block.super }}

  <script src="{% static 'neon/assets/js/bootstrap-datepicker.js' %}"></script>
  <script src="{% static 'neon/assets/js/bootstrap-timepicker.min.js' %}"></script>
  <script src="{% static 'js/jquery.formset.js' %}"></script>
  <script type="text/javascript">
  function initializeDepositoryItemAutoComplete(context){
      $(".depository-item-request-autocomplete", context || null).autocomplete({
          source: "{% url 'activities:autocomplete_items' %}",
          position: { my : "right top", at: "right bottom" },
          minLength: 2
      });
  }

  function initializeEventDateAndTimePickers(context) {
      // Select all fields whose id ends with '-date'
      $("[id$='-date']", context || null).datepicker();
      // Select fields whose id ends with '-start_time' or '-end_time'
      $("[id$='-start_time'], [id$='-end_time']", context || null).timepicker();

  }

  $(function() {
      // Initiate datepickers
      $("#id_start_date, #id_end_date").datepicker();

      // Initiate formsets
      $("#id_{{ event_request_formset.prefix }}_formset").find(".form-container").formset({
          prefix: '{{ event_request_formset.prefix }}',
          addText: "<i class='entypo-list-add'></i> {% trans "أضف فعالية" %}",
          deleteText: "<i class='entypo-cancel'></i> {% trans "احذف هذه الفعالية" %}",
          addCssClass: 'add-row btn btn-icon btn-primary',
          deleteCssClass: 'delete-row btn btn-xs',
          formCssClass: 'event-request-formset',
          added: function (row) {
              // Initialize date and time pickers for new row
              initializeEventDateAndTimePickers(row);

              // Move the event deletion button to the panel heading
              row.find(".delete-row").appendTo(row.find(".panel-options"));
          }
      });
      $("#id_{{ depository_item_request_formset.prefix }}_formset").find(".form-container").formset({
          prefix: '{{ depository_item_request_formset.prefix }}',
          addText: "{% trans "أضف متطلّبًا" %}",
          deleteText: "{% trans "احذف" %}",
          addCssClass: 'add-row btn btn-xs btn-primary',
          deleteCssClass: 'delete-row btn btn-xs btn-default',
          formCssClass: 'event-request-formset',
          added: function (row) {
              // Initialize auto-complete for added row
              initializeDepositoryItemAutoComplete(row);
          }

      });
      $("#id_{{ requirement_request_formset.prefix }}_formset").find(".form-container").formset({
          prefix: '{{ requirement_request_formset.prefix }}',
          addText: "{% trans "أضف متطلّبًا" %}",
          deleteText: "{% trans "احذف" %}",
          addCssClass: 'add-row btn btn-xs btn-primary',
          deleteCssClass: 'delete-row btn btn-xs btn-default',
          formCssClass: 'event-request-formset'
      });
      $("#id_{{ file_attachment_formset.prefix }}_formset").find(".form-container").formset({
          prefix: '{{ file_attachment_formset.prefix }}',
          addText: "{% trans "أضف ملفًا مرفقًا" %}",
          deleteText: "{% trans "احذف" %}",
          addCssClass: 'add-row btn btn-xs btn-primary',
          deleteCssClass: 'delete-row btn btn-xs btn-default',
          formCssClass: 'event-request-formset'
      });

      // Initialize auto-complete for depository item formset
      initializeDepositoryItemAutoComplete();
      // Initialize date and time pickers for event request formset
      initializeEventDateAndTimePickers();

      // Move the event deletion button to the panel heading
      $("#id_{{ event_request_formset.prefix }}_formset").find(".delete-row")
          .appendTo("#id_{{ event_request_formset.prefix }}_formset .panel-options");
      // Place the event addition button immediately after the formset rather than at the end of it
      $("#id_{{ event_request_formset.prefix }}_formset").find(".add-row")
          .insertAfter("#id_{{ event_request_formset.prefix }}_formset");
  });
  </script>

{% endblock %}