<!DOCTYPE html>{% load staticfiles %}
<html class="detail" lang="ar">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ invitation.short_description|striptags }}">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Seraj_Init" />
    <meta name="twitter:title" content="{{ invitation.title }}" />
    <meta name="twitter:description" content="{{ invitation.short_description|striptags }}" />
    <title>إنجاز | الريديثون</title>
    <link rel="icon" href="{% static 'logo/favicon.png' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-3.3.6.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-rtl-3.3.4.min.css' %}">
    <link rel="stylesheet" href="{% static 'neon/assets/css/font-icons/entypo/css/entypo.css' %}">
    <link rel="stylesheet" href="{% static 'neon/assets/css/font-icons/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'neon/assets/css/neon-forms.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.min.css' %}">
	<link rel="stylesheet" href="{% static 'neon/assets/css/custom.css' %}">
<style>
@font-face {
    font-family: 'GE Dinar One';
    font-weight: lighter;
    src: url("{% static 'fonts/ge-dinar-one-light.woff' %}");
}
		
@font-face {
    font-family: 'GE Dinar One';
    font-weight: normal;
    src: url("{% static 'fonts/ge-dinar-one-med.woff' %}");
}

body {
  font-family: 'GE Dinar One', serif;
}

html.detail{
    background: linear-gradient( rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8) ), url("{% static 'img/bulb/recruitment-background.jpg' %}") no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}
html.detail body, h1{
    background-color: transparent;
    color: white;
}

.modal{
color: black;
}

.detail a{
    color: #85C7FF;
}
footer{
    padding: 60px 0;
}

.step-section {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 10px;
    width: 90%;
    margin-right: auto;
    margin-left: auto;
    margin-bottom: 20px;
    color: white;
}

.checkbox label{
    margin-right: 10px;
}

#third-phase, #promotion-step{
    display: none;
}

#sad-child{
    border-radius: 10px;
    max-width: 100%;
}

#delete-button input[type='submit']:disabled{
    background-color: #497d49;
}

p.instructions{
    text-align: justify;
}

p.intro{
background: rgba(0, 0, 0, 0.7);
border-radius: 10px;
padding: 18px;
width: 90%;
margin-right: auto;
margin-left: auto;
margin-bottom: 20px;
color: white;
font-size: 15px;
}

p.explaination{
border-radius: 10px;
padding: 10px;
margin-right: auto;
margin-left: auto;
margin-bottom: 0px;
font-size: 14px;
color: #e8ff74;
}

hr{
margin-bottom: 5px;
    max-width: 100px;
}

.form-group .checkbox{
    margin-right: 15px;
}

.update-book{
    cursor: pointer;
}
</style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
                <div class="text-center">

                    <img class="animated bounceInDown" src="{% static 'img/bulb/logo.png' %}">
                    <h1>ريديثون</h1>
                    <p style="font-size: 1.2em;">نعدو، والأميال هي صفحات كتاب لم نقرأه بعد!</p>
                </div>
                <video class="img-responsive" autoplay loop muted>
                    <source src="https://enjazportal.com/static/readathon.mp4" type="video/mp4">
                </video>
                <p class="intro instructions">
في مكتبة كلٍ منا ذلك الكتاب الرائع الذي لم نتفرّغ بعد لقراءته.  <span style="background-color: #ffff1d80; padding: 0px 4px;">كفى! حان الوقت!</span><br>هذا الأسبوع نقيم في سِراج الريديثون الأول. في الريديثون، يصوغ كلٌ منّا خطّة مكثّفة للقراءة للأسبوع القادم، وبعد إنجاز الخطة يكون مطلوبا من كل مشاركة ومشارك العمل على "منتج ثقافي" (تلخيص للكتاب مثلا أو مراجعة أو تأملات أو نقد أو تسجيل صوتي لجزء ثمين من الكتاب). تحصل القارئة والقارئ الذين يتمّون خططهم ويخرجون بمنتجِ ثقافي على ميدالية المارثون. على هامش الريديثون، ستعقد جلسة قبل بداية الريديثون وبعده تجمع أفضل 25 مُشاركة لنقاش التجربة.<br>يمتد الريديثون الأول في الفترة من الخميس 20 أكتوبر وحتى الأربعاء 26 أكتوبر.<br>يكون تسجيل الكتب من خلال هذه الصفحة، وسيتم التواصل مع كل من سجّل.
                </p>
                <div class="row text-center" style="font-size: 1.2em; margin-bottom: 10px;">
							<div>
								<i class="entypo-calendar"></i>
                                {{ readathon.start_date|date:"l j F Y" }} - {{ readathon.end_date|date:"l j F Y" }}
							</div>
                </div>
                <div class="text-center">

                {% if user.is_authenticated and not user_books.exists %}
                <button data-action="add" id="add-book" class="btn btn-lg btn-success">سجّل مشاركتي!</button>
                {% elif user.is_authenticated and user_books.exists %}
                    <hr>
                    <h2 class="text-center" style="color: white;">كُتبي</h2>
                    <p>انقر على الكتاب تُحدّثه!</p>
                    <div class="row">                        
                    {% for book_commitment in user_books %}
                        <div class="{% if user_books.count == 1 %}col-sm-offset-3 {% endif %}col-sm-6 text-center">
                                <div class="book-image update-book" data-url="{% url 'bulb:update_book_commitment' readathon.pk book_commitment.pk %}" style="background-image:url('{{ book_commitment.cover.url }}');"></div>
                                <div class="progress">
                                  <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="{{ book_commitment.get_progress_percentage }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ book_commitment.get_progress_percentage }}%">
                                    {{ book_commitment.get_progress_percentage }}%
                                  </div>
                                </div>
                        </div>
                    {% endfor %}
                    </div>
                    {% if not readathon.has_started %}<button data-action="add" id="add-book" class="btn btn-lg btn-success">سجّل كتابًا آخر!</button>{% endif %}
                {% else %}
                <a style="color: white;" href="{% url 'userena_signin' %}?next={{ request.path }}" class="btn btn-lg btn-success">أدخلني لإنجاز كي أؤكد الحضور</a>
                {% endif %}
                </div>
                <hr>
                <h2 class="text-center" style="color: white;">المشاركون والمشاركات</h2>
                <div class="row">
                {% for book_commitment in readathon.bookcommitment_set.all %}
                    <div class="col-sm-6 text-center">
                            <div class="book-image" style="background-image:url('{{ book_commitment.cover.url }}');"></div>
                        {% if book_commitment.user.username != "mubayrik080" %}
                            {{ book_commitment.user.common_profile.get_ar_full_name }}
                        {% else %}
                            أسامة خالد
                        {% endif %}
                        {% if book_commitment.get_progress_percentage %}
                            <div class="progress">
                              <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="{{ book_commitment.get_progress_percentage }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ book_commitment.get_progress_percentage }}%">
                                {{ book_commitment.get_progress_percentage }}%
                              </div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
                </div>
                <!-- Footer -->
                <footer>
                        <div class="row">
                            <div class="col-lg-10 col-lg-offset-1 text-center">
                                <p class="text-muted">بُني بأيدٍ طلابيّة</p>
                                <p class="text-muted">حقك في النسخ مكفول.</p>
                                <a target="_blank" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ar"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
                            </div>
                        </div>
                </footer>
            </div> <!--col-->
        </div><!--row-->
    </div><!--container-->
{% if request.get_host == 'enjazportal.com' or request.get_host == 'www.enjazportal.com' %}
	<!-- Piwik -->
	<script type="text/javascript">
	  var _paq = _paq || [];
      {% if user.is_authenticated %}
      _paq.push(['setUserId', '{{ user.username }}']);
      {% endif %}
	  _paq.push(['trackPageView']);
	  _paq.push(['enableLinkTracking']);
	  (function() {
	    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://enjazportal.com/stats/";
	    _paq.push(['setTrackerUrl', u+'piwik.php']);
	    _paq.push(['setSiteId', 1]);
	    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
	    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
	  })();
	</script>
	<noscript><p><img src="//enjazportal.com/stats/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
    {% endif %}
	<script src="{% static 'neon/assets/js/jquery-1.11.0.min.js' %}"></script>
    <script src="{% static 'neon/assets/js/toastr.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>

    
<script type="text/javascript">
    $(function () {
        // initialize session edit modal
        $('#edit-book-commitment-modal').modal({
          keyboard: false,
          backdrop: 'static',
          show    : false,
        });
        $("#add-book").click(function () {
            $("#edit-book-commitment-modal").modal('show');

            $("#edit-book-commitment-modal .modal-title").html("المشاركة في الريديثون");
            $("#edit-book-commitment-modal .modal-body").load("{% url 'bulb:readathon_introduction' readathon.pk %}", function(){
                $('.end-readathon-introduction').click(function() {
                    $("#edit-book-commitment-modal .modal-body").load("{% url 'bulb:add_book_commitment' readathon.pk %}");
            });
            });

            var $submitButton = $("#edit-book-commitment-modal button.submit-button");
            // Unbind any handlers previously attached to the submit button
            // This is necessary to avoid multiple submissions of the form
            $submitButton.off('click');
            $submitButton.click(function () {
                $("form#edit-book-commitment-form").submit();
            });
        });
        $(".edit-book").click(function () {
            // show the edit book modal {# you can find it in bulb/exchange/home.html #}
            $("#edit-book-commitment-modal").modal('show');
            var url = $(this).data('url'); 

            $("#edit-book-commitment-modal .modal-title").html("عدّل كتاب");
            $("#edit-book-commitment-modal .modal-body").load(url);

            var $submitButton = $("#edit-book-commitment-modal button.submit-button");
            // Unbind any handlers previously attached to the submit button
            // This is necessary to avoid multiple submissions of the form
            $submitButton.off('click');
            $submitButton.click(function () {
                $("form#edit-book-form").submit();
            });
        });
        $("button.confirm-delete-book").click(function(){
            var confirm_url = $(this).data('confirm-url');
            var deletion_url = $(this).data('deletion-url');
            $('#confirm-delete-book-modal .modal-body').load(confirm_url);
            $("#delete-book").data('deletion-url', deletion_url); 
            $("#confirm-delete-book-modal").modal('show');
        });
        
        $(".update-book").click(function(){
            $("#update-book-commitment-modal").modal('show');
            var url = $(this).data('url');
            $("#update-book-commitment-modal .modal-body").load(url);
            var $submitButton = $("#update-book-commitment-modal button.submit-button");
            // Unbind any handlers previously attached to the submit button
            // This is necessary to avoid multiple submissions of the form
            $submitButton.off('click');
            $submitButton.click(function () {
                $("form#update-book-form").submit();
            });
        });
    });
{% include 'bulb/adjust_modal_size.js' %}
</script>

{% with modal_id='edit-book-commitment-modal' %}
    {% include "bulb/groups/common_edit_modal.html" %}
{% endwith %}

<!--Update modal -->
    <div class="modal fade" id="update-book-commitment-modal">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">تحديث الإنجاز</h4>
      </div>
      <div class="modal-body">
            {% include "media/polls/ajax-loader.html" %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">ألغِ</button>
        <button id="update-book" type="button" class="btn btn-success submit-button">حدّث</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{%  if user.is_authenticated and not user.is_superuser and not user.common_profile.canceled_twitter_connection and not user.social_auth.exists %}
<!---Twitter Modal -->
<div class="modal fade" id="connect-twitter">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">أغلق</span></button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body ativa-scroll text-center">
          <h2>بات الآن ممكنا إخبار الأصدقاء عن أنشطة سِراج!</h2>
          <p>يتيح ربط حساب بوابة إنجاز بحسابك على تويتر إخبار متابعيك ومتابعاتك عن أنشطة النادي، ومساعدتهم في اكتشافها!</p>
          <p>بعد الربط، سوف تُكتب تغريدة آلية في حسابك عندما تؤكد انضمامك لأحد الأنشطة، ويمكنك إلغاء الربط في أي وقت.</p>
          <div class="row">
              <a style="color: #1da1f3;" href="{% url 'social:begin' 'twitter' %}?next={{ request.path }}" class="btn btn-lg"><i class="fa fa-twitter fa-4x"></i><br>اربط حسابي بتويتر</a>
          </div>
          <div class="row">
                  <a id="cancel-twitter-connection" style="color: rgb(243, 29, 89)"><i class="fa fa-times fa-4x"></i><br> لا تسألني مُجدًدا</a>
          </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript">
{%  if user.is_authenticated and not user.is_superuser and not user.common_profile.canceled_twitter_connection and not user.social_auth.exists %}
$(function(){
    $('#connect-twitter').modal({
      keyboard: true,
      backdrop: 'static',
    });
    $("#cancel-twitter-connection").click(function(){
        $.ajax({
            url: "{% url 'cancel_twitter_connection' %}",
            type: 'GET',
            cache: false,
            success: function(data){
                // show success message (using toastr)
                toastr.options.positionClass = "toast-top-left";
                toastr.success("لن يظهر السؤال مُجددًا.");
                // hide modal
                $("#connect-twitter").modal('hide');
            }
        });

    });
});
{% endif %}
</script>
    

{% endif %}
</body>
</html>

