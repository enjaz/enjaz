{% extends 'certificates/certificate_base.html' %}{% load staticfiles %}{% load certificates_utils %}

{% block content %}
<h1 style="text-align: center">نظام الشهادات</h1>
    {% if  user|certificate_has_surveys %}
        <h3> الجلسات التي تتطلب تعبئة الإستبيان</h3>
        {% for certificate in certificates %}
            <div style="float: right;">
                <li style="margin-bottom:5%">{{ certificate.content_object.name }}</li>
                <button id="survey" data-session="{{ certificate.content_object.name }}" data-session-pk="{{ certificate.content_object.pk }}" data-survey-pk="{{ certificate.content_object.mandotary_survey.pk }}" data-url="{% url 'events:handle_survey' certificate.content_object.pk certificate.content_object.mandotary_survey.pk%}" class='btn btn-icon btn-success'>
                    <i class="entypo-pencil"></i>
                   تعبئة الإستبيان
                </button>
            </div>
        {% endfor %}
    {% endif %}

<table class="display datatable compact dt-responsive">
    <thead>
        <th>الشهادة</th>
        <th class="not-mobile">الرمز</th>
        <th class="not-mobile">التاريخ</th>
    </thead>
    <tbody>
        {% for certificate in certificates %}
        <tr>
            <td><a href="{% url 'certificates:download_certificate' certificate.verification_code %}">{{ certificate }}</a></td>
            <td class="english-field">{{ certifiacte.verification_code }}</td>
            <td data-order="{{ certificate.submission_date|date:'U' }}">{{ certificate.submission_date|date:"j F Y" }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>


{% endblock %}
{% block customscript %}
    <script src="{% static 'neon/assets/js/toastr.js' %}"></script>
	<link rel="stylesheet" href="{% static 'css/jquery.dataTables.min.css' %}">
	<link rel="stylesheet" href="{% static 'js/datatables/responsive/css/responsive.dataTables.min.css' %}">
	<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'js/datatables/responsive/js/dataTables.responsive.min.js' %}"></script>
<script type="text/javascript">
    $(function(){
        $('.datatable').DataTable({
            order: [[ 2, "desc" ]],
            language: {% include 'js/dataTables-arabic.json' %}
        });
    });
</script>
{% load staticfiles %}
<script type="text/javascript">
    $(function () {
        // initialize project edit modal
        $('#edit-survey-modal').modal({
          keyboard: false,
          backdrop: 'static',
          show    : false,
        });
        $("#survey").click(function () {
            session_pk =  $(this).data("session-pk");
            survey_pk = $(this).data("survey-pk");
            url = $(this).data('url')
            session_title = $(this).data("session");

            $("#edit-survey-modal").modal('show');

            $("#edit-survey-modal .modal-title").html("تعبئة استبيان"+session_title);
            $("#edit-survey-modal .modal-body").load(url);

            var $submitButton = $("#edit-survey-modal button.submit-button");
            $submitButton.off('click');
            $submitButton.click(function () {
                $("form#edit-survey-form").submit();
            });
        });
    });
{% include 'bulb/adjust_modal_size.js' %}
</script>
{% with modal_id='edit-survey-modal' %}
    {% include "bulb/groups/common_edit_modal.html" %}
{% endwith %}
{% endblock %}
