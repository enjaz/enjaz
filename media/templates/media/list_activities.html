{% extends 'media_base.html' %}{% load staticfiles %}

{% block content %}
<style>
	tr {
		height: 30px;
	}
</style>
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/plug-ins/be7019ee387/integration/bootstrap/3/dataTables.bootstrap.css">

<h3>الأنشطة المعتمدة
<a href="{% url 'media:list_reports' %}" class="btn btn-xs btn-default">
	استعرض جميع التقارير 
	<i class="entypo-left-bold"></i>
</a>
</h3>
<table id="activity_list">
	<thead>
        <tr>
            <th>اسم النشاط</th>
            <th>الجهة المنظمة</th>
            <th>الموعد</th>
            <th>تاريخ الاعتماد</th>
            <th>الخيارات</th>
        </tr>
    </thead>
    <tbody>
    	{% for activity in activities %}
    	{% for episode in activity.episode_set.all %}
        <tr>
            <td><a href="{% url 'activities:show' activity.pk %}">{{ activity.name }}</a></td>
            <td><a href="{% url 'clubs:show' activity.primary_club.pk %}">{{ activity.primary_club.name }}</a></td>
            <td>
            	<div class="row">
						<div>
							{# }<i class="entypo-calendar"></i> #}
							{{ episode.start_date|date:"j F" }}
							-
							{{ episode.end_date|date:"j F" }}
						</div>
						{% comment %}
						<div>
							<i class="entypo-clock"></i>
							{{ episode.start_time }}
							-
							{{ episode.end_time }}
						</div>
						<div>
							<i class="entypo-location"></i>
							{{ episode.location }}
						</div>
						{% endcomment %}
				</div>
            </td>
            <td>{{ activity.submission_date|date:"j F" }}</td>{# FIXME: replace with approval date #}
            <td>{# options #}
            	<div class="row">
            	{# first, the follow-up report #}
            	<div class="col-md-6">
	            	{% if episode.followupreport %}
	            		<a href="{% url 'media:show_report' episode.pk %}"
	            		class="btn btn-green btn-xs">استعرض التقرير</a>
	            	{% elif episode.report_is_due %}
	            		<a class="btn btn-gold btn-xs disabled">بانتظار رفع التقرير</a>
	            	{% elif episode.report_is_overdue %}
	            		<a class="btn btn-red btn-xs disabled">بانتظار رفع التقرير</a>
	            	{% else %}
	            		<a class="btn btn-default btn-xs disabled">بانتظار انتهاء النشاط</a>
	            	{% endif %}
            	</div>
            	
            	{# second, the story #}
            	<div class="col-md-6">
            		{% if not episode.story %}
            			{# if there is no story, then the button should point to the create story view #}
            			{% if not episode.storytask_set.all %}
            				<a href="{% url 'media:create_story' episode.pk %}"
            				class="btn btn-default btn-xs">اكتب تغطية</a>
            			{% else %}
            				{# when there is no story, the only task that could be there will be at index 0 #}
            				{% if episode.storytask_set.0.assignee == user %}{# TODO: I'm not in favor of using index 0 #}
            					<a href="{% url 'media:create_story' episode.pk %}"
								class="btn btn-orange btn-xs">اكتب تغطية</a>
            				{% else %}
            					<a href="{% url 'media:create_story' episode.pk %}" class="btn btn-orange btn-xs">
            						معيَّن لـ{{ episode.storytask_set.0.assignee.student_profile.ar_first_name }} 
            						{{ episode.storytask_set.0.assignee.student_profile.ar_last_name }}            						
        						</a>
            				{% endif %}
            			{% endif %}
            		{% else %}
            			{# if there is a story, the button should point to the show story view #}
            			{% if episode.has_incomplete_storytask %}
            				{# TODO: if assigned to user, show in different color #}
            				{# The issue here is how to get the incomplete task #}
            				<a href="{% url 'media:show_story' episode.pk %}"
            				class="btn btn-gold btn-xs">استعرض التغطية (توجد ملاحظات)</a>
            			{% else %}
            				<a href="{% url 'media:show_story' episode.pk %}"
            				class="btn btn-blue btn-xs">استعرض التغطية</a>
            			{% endif %}
            		{% endif %}
            	</div>
            	</div>
            </td>
        </tr>
        {% endfor %}
        {% endfor %}
    </tbody>
</table>
<link rel="stylesheet" href="{% static 'neon/assets/js/datatables/responsive/css/datatables.responsive.css' %}">
{% endblock %}

{% block customscript %}
<!-- <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.0/js/jquery.dataTables.js"></script> -->
<script src="{% static 'neon/assets/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'neon/assets/js/dataTables.bootstrap.js' %}"></script>
<!-- <script src="//cdn.datatables.net/plug-ins/be7019ee387/integration/bootstrap/3/dataTables.bootstrap.js"></script> -->
<script src="{% static 'neon/assets/js/datatables/TableTools.min.js' %}"></script>
<script src="{% static 'neon/assets/js/datatables/responsive/js/datatables.responsive.js' %}"></script>
<script>
$(document).ready(function () {
	$('#activity_list').DataTable();
});
</script>
{% endblock %}